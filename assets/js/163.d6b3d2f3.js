(window.webpackJsonp=window.webpackJsonp||[]).push([[163],{575:function(e,t,r){"use strict";r.r(t);var n=r(21),o=Object(n.a)({},(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[r("p",[e._v("这个其实可以使用事务来实现，比如我们可以用MySQL，抢红包时先开启事务，然后加上行锁，修改完毕后我们提交事务，释放行锁")]),e._v(" "),r("p",[e._v("或者我们可以使用Redis，我们获取分布式锁，然后对数据进行操作，流程图如下")]),e._v(" "),r("p",[r("img",{attrs:{src:"https://img.xiaoyou66.com/2021/03/30/21ebe15bfd306.jpg",alt:"img"}})]),e._v(" "),r("ul",[r("li",[e._v("老板发红包，此时缓存初始化红包个数，红包金额(单位分)，并异步入库。")]),e._v(" "),r("li",[e._v("抢红包，判断缓存剩余红包金额，剩余金额大于零则抢到红包，否则手慢了，红包派完了")]),e._v(" "),r("li",[e._v("拆红包，根据 "),r("code",[e._v("redPacketId")]),e._v(" 获取分布式锁，如果获取到锁，红包个数减一，如果剩余红包个数大于零抢红包成功、否则失败。成功则计算红包金额，缓存总红包金额减去抢到的红包金额，异步入库、异步到账。")])]),e._v(" "),r("p",[e._v("参考")]),e._v(" "),r("ol",[r("li",[r("a",{attrs:{href:"https://yuerblog.cc/2017/10/27/wechat-red-packet-arch/",target:"_blank",rel:"noopener noreferrer"}},[e._v("微信红包的设计考虑 | 鱼儿的博客 (yuerblog.cc)"),r("OutboundLink")],1)]),e._v(" "),r("li",[r("a",{attrs:{href:"https://zhuanlan.zhihu.com/p/105692236",target:"_blank",rel:"noopener noreferrer"}},[e._v("微信高并发抢红包秒杀实战案例 - 知乎 (zhihu.com)"),r("OutboundLink")],1)])])])}),[],!1,null,null,null);t.default=o.exports}}]);